<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–†–µ–∂–∏–º —Å–Ω–∞ ‚Äî Telegram WebApp</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root {
      --bg: #0f1115;
      --card: #161923;
      --text: #e9eef6;
      --muted: #9aa4b2;
      --border: #232838;
    }
    * { box-sizing: border-box; }
    html, body {
      margin: 0; padding: 0; height: 100%;
      background: var(--bg); color: var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }
    .wrap { min-height: 100%; display: grid; place-items: center; padding: 24px; }
    .card {
      width: 100%; max-width: 520px; background: var(--card); border: 1px solid var(--border);
      border-radius: 16px; padding: 20px; box-shadow: 0 8px 32px rgba(0,0,0,0.35);
    }
    h1 { margin: 0 0 12px; font-size: 20px; }
    p { margin: 0 0 18px; color: var(--muted); }
    label { display: block; font-size: 13px; color: var(--muted); margin-bottom: 6px; }
    input[type="time"] {
      display: block; width: 100%; background: #0e1118; color: var(--text);
      border: 1px solid var(--border); border-radius: 12px; padding: 12px 14px; font-size: 16px;
      outline: none; transition: border-color .2s ease;
    }
    input[type="time"]:focus { border-color: #4f8cff; }
    .row { display: grid; gap: 14px; }
    .row.two { grid-template-columns: 1fr 1fr; }
    .btn {
      margin-top: 18px; width: 100%; padding: 12px 16px; font-size: 16px; border-radius: 12px; border: none;
      background: #4f8cff; color: white; cursor: pointer; transition: opacity .2s ease;
    }
    .btn:disabled { opacity: .6; cursor: not-allowed; }
    .hint { font-size: 12px; color: var(--muted); margin-top: 8px; text-align: center; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>üõå –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–µ–∂–∏–º–∞ —Å–Ω–∞</h1>
      <p>–£–∫–∞–∂–∏ –≤—Ä–µ–º—è –æ—Ç—Ö–æ–¥–∞ –∫–æ —Å–Ω—É –∏ –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏—è. –§–æ—Ä–º–∞—Ç 24‚Äë—á–∞—Å–æ–≤–æ–π, HH:MM.</p>

      <div class="row two">
        <div>
          <label for="sleep">–û—Ç—Ö–æ–¥ –∫–æ —Å–Ω—É</label>
          <input id="sleep" type="time" step="60" required />
        </div>
        <div>
          <label for="wake">–ü—Ä–æ–±—É–∂–¥–µ–Ω–∏–µ</label>
          <input id="wake" type="time" step="60" required />
        </div>
      </div>

      <button id="send" class="btn" disabled>–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
      <div class="hint">–î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –±–æ—Ç—É –∏ –æ–∫–Ω–æ –∑–∞–∫—Ä–æ–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.</div>
    </div>
  </div>

  <script>
    const tg = window.Telegram?.WebApp;

    // Apply Telegram theme (if available)
    function applyThemeFromTelegram() {
      if (!tg) return;
      const theme = tg.themeParams || {};
      const bg = theme.bg_color || '#0f1115';
      const text = theme.text_color || '#e9eef6';
      const hint = theme.hint_color || '#9aa4b2';
      const card = theme.secondary_bg_color || '#161923';
      const border = theme.section_separator_color || '#232838';
      document.documentElement.style.setProperty('--bg', bg);
      document.documentElement.style.setProperty('--text', text);
      document.documentElement.style.setProperty('--muted', hint);
      document.documentElement.style.setProperty('--card', card);
      document.documentElement.style.setProperty('--border', border);
    }

    function isValidTime(v) {
      return /^\d{2}:\d{2}$/.test(v);
    }

    function updateMainButton() {
      if (!tg) return;
      const sleep = document.getElementById('sleep').value;
      const wake = document.getElementById('wake').value;
      const ok = isValidTime(sleep) && isValidTime(wake);
      tg.MainButton.setText('–û—Ç–ø—Ä–∞–≤–∏—Ç—å');
      tg.MainButton[ok ? 'show' : 'hide']();
      document.getElementById('send').disabled = !ok;
    }

    function sendPayload() {
      const sleep = document.getElementById('sleep').value;
      const wake = document.getElementById('wake').value;
      if (!isValidTime(sleep) || !isValidTime(wake)) return;

      const payload = JSON.stringify({ sleep_time: sleep, wake_time: wake });
      try {
        tg?.sendData(payload);
      } catch (e) {
        console.error('sendData error', e);
      }
      // Close shortly after sending, to ensure the event reaches the bot
      setTimeout(() => tg?.close(), 150);
    }

    function init() {
      applyThemeFromTelegram();
      if (tg) {
        tg.ready();
        tg.expand();
        tg.MainButton.onClick(sendPayload);
      }
      document.getElementById('sleep').addEventListener('input', updateMainButton);
      document.getElementById('wake').addEventListener('input', updateMainButton);
      document.getElementById('send').addEventListener('click', sendPayload);
      updateMainButton();
    }

    init();
  </script>
</body>
</html>
