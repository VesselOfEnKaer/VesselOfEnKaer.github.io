<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–†–µ–∂–∏–º —Å–Ω–∞ ‚Äî Telegram WebApp</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root {
      --bg: #0f1115;
      --card: #161923;
      --text: #e9eef6;
      --muted: #9aa4b2;
      --border: #232838;
      --accent: #4f8cff;
    }
    * { box-sizing: border-box; }
    html, body {
      margin: 0; padding: 0; height: 100%;
      background: var(--bg); color: var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }
    .wrap { min-height: 100%; display: grid; place-items: center; padding: 24px; }
    .card {
      width: 100%; max-width: 560px; background: var(--card); border: 1px solid var(--border);
      border-radius: 16px; padding: 20px; box-shadow: 0 8px 32px rgba(0,0,0,0.35);
    }
    h1 { margin: 0 0 12px; font-size: 20px; }
    p { margin: 0 0 18px; color: var(--muted); }
    .grid { display: grid; gap: 12px; }
    .menu-btn {
      display: flex; align-items: center; justify-content: space-between;
      width: 100%; padding: 14px 16px; font-size: 16px; border-radius: 12px; border: 1px solid var(--border);
      background: #10141e; color: var(--text); cursor: pointer;
    }
    .menu-btn:disabled { opacity: .6; cursor: not-allowed; }
    .row { display: grid; gap: 14px; }
    .row.two { grid-template-columns: 1fr 1fr; }
    label { display: block; font-size: 13px; color: var(--muted); margin-bottom: 6px; }
    input[type="time"] {
      display: block; width: 100%; background: #0e1118; color: var(--text);
      border: 1px solid var(--border); border-radius: 12px; padding: 12px 14px; font-size: 16px;
      outline: none; transition: border-color .2s ease;
    }
    input[type="time"]:focus { border-color: var(--accent); }
    .btn {
      margin-top: 18px; width: 100%; padding: 12px 16px; font-size: 16px; border-radius: 12px; border: none;
      background: var(--accent); color: white; cursor: pointer; transition: opacity .2s ease;
    }
    .btn:disabled { opacity: .6; cursor: not-allowed; }
    .hint { font-size: 12px; color: var(--muted); margin-top: 8px; text-align: center; }
    .topbar { display: flex; align-items: center; gap: 8px; margin: -8px 0 12px; }
    .back { padding: 6px 10px; border-radius: 10px; background: #10141e; border: 1px solid var(--border); color: var(--text); cursor: pointer; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <!-- HOME -->
      <section id="screen-home" class="grid">
        <h1>üåô –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω</h1>
        <p>–í—ã–±–µ—Ä–∏ —Ä–∞–∑–¥–µ–ª. –≠—Ç–æ –º–∏–Ω–∏‚Äë–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±–æ—Ç–∞ –¥–ª—è —Ä–µ–∂–∏–º–∞ —Å–Ω–∞.</p>
        <button class="menu-btn" id="btn-settings">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ <span>‚Ä∫</span></button>
        <button class="menu-btn" disabled onclick="alert('–°–∫–æ—Ä–æ!')">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ <span>‚Ä¢</span></button>
        <button class="menu-btn" disabled onclick="alert('–°–∫–æ—Ä–æ!')">‚è±Ô∏è –¢–∞–π–º–µ—Ä <span>‚Ä¢</span></button>
      </section>

      <!-- SETTINGS -->
      <section id="screen-settings" class="grid hidden">
        <div class="topbar">
          <button class="back" id="back-from-settings">‚Üê –ù–∞–∑–∞–¥</button>
          <h1 style="margin:0">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h1>
        </div>
        <button class="menu-btn" id="btn-edit-schedule">‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ <span>‚Ä∫</span></button>
      </section>

      <!-- SCHEDULE -->
      <section id="screen-schedule" class="grid hidden">
        <div class="topbar">
          <button class="back" id="back-from-schedule">‚Üê –ù–∞–∑–∞–¥</button>
          <h1 style="margin:0">üõå –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–µ–∂–∏–º–∞ —Å–Ω–∞</h1>
        </div>
        <p>–£–∫–∞–∂–∏ –≤—Ä–µ–º—è –æ—Ç—Ö–æ–¥–∞ –∫–æ —Å–Ω—É –∏ –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏—è. –§–æ—Ä–º–∞—Ç 24‚Äë—á–∞—Å–æ–≤–æ–π, HH:MM.</p>
        <div class="row two">
          <div>
            <label for="sleep">–û—Ç—Ö–æ–¥ –∫–æ —Å–Ω—É</label>
            <input id="sleep" type="time" step="60" required />
          </div>
          <div>
            <label for="wake">–ü—Ä–æ–±—É–∂–¥–µ–Ω–∏–µ</label>
            <input id="wake" type="time" step="60" required />
          </div>
        </div>
        <button id="send" class="btn" disabled>–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        <div class="hint">–î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –±–æ—Ç—É –∏ –æ–∫–Ω–æ –∑–∞–∫—Ä–æ–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.</div>
      </section>
    </div>
  </div>

  <script>
    const tg = window.Telegram?.WebApp;

    // Apply Telegram theme (if available)
    function applyThemeFromTelegram() {
      if (!tg) return;
      const theme = tg.themeParams || {};
      const bg = theme.bg_color || '#0f1115';
      const text = theme.text_color || '#e9eef6';
      const hint = theme.hint_color || '#9aa4b2';
      const card = theme.secondary_bg_color || '#161923';
      const border = theme.section_separator_color || '#232838';
      document.documentElement.style.setProperty('--bg', bg);
      document.documentElement.style.setProperty('--text', text);
      document.documentElement.style.setProperty('--muted', hint);
      document.documentElement.style.setProperty('--card', card);
      document.documentElement.style.setProperty('--border', border);
    }

    // Navigation between screens
    function showScreen(name) {
      for (const id of ['home','settings','schedule']) {
        document.getElementById(`screen-${id}`).classList.toggle('hidden', id !== name);
      }
      // Configure MainButton per screen
      if (!tg) return;
      if (name === 'schedule') {
        tg.MainButton.setText('–û—Ç–ø—Ä–∞–≤–∏—Ç—å');
        updateMainButton(); // decides show/hide
      } else {
        tg.MainButton.hide();
      }
    }

    function isValidTime(v) { return /^\d{2}:\d{2}$/.test(v); }

    function init() {
      if (tg) {
        tg.ready();
        tg.expand();
    
        // —Å–ª—É—à–∞–µ–º —Å–∏—Å—Ç–µ–º–Ω—É—é –∫–Ω–æ–ø–∫—É
        tg.onEvent("mainButtonClicked", sendPayload);
      }
    
      document.getElementById("sleep").addEventListener("input", updateMainButton);
      document.getElementById("wake").addEventListener("input", updateMainButton);
    }
    
    function updateMainButton() {
      if (!tg) return;
      const sleep = document.getElementById("sleep").value;
      const wake = document.getElementById("wake").value;
      if (isValidTime(sleep) && isValidTime(wake)) {
        tg.MainButton.setText("–û—Ç–ø—Ä–∞–≤–∏—Ç—å");
        tg.MainButton.show();
      } else {
        tg.MainButton.hide();
      }
    }
    
    function sendPayload() {
      const sleep = document.getElementById("sleep").value;
      const wake = document.getElementById("wake").value;
      if (!isValidTime(sleep) || !isValidTime(wake)) return;
    
      const payload = JSON.stringify({ sleep_time: sleep, wake_time: wake });
      tg.sendData(payload);
      tg.close();
    }

      // Wire buttons
      document.getElementById('btn-settings').addEventListener('click', () => showScreen('settings'));
      document.getElementById('btn-edit-schedule').addEventListener('click', () => showScreen('schedule'));
      document.getElementById('back-from-settings').addEventListener('click', () => showScreen('home'));
      document.getElementById('back-from-schedule').addEventListener('click', () => showScreen('settings'));

      document.getElementById('sleep').addEventListener('input', updateMainButton);
      document.getElementById('wake').addEventListener('input', updateMainButton);
      document.getElementById('send').addEventListener('click', sendPayload);

      // Deep-link: ?screen=schedule to open schedule directly
      const params = new URLSearchParams(location.search);
      const screen = (params.get('screen') || 'home').toLowerCase();
      if (screen === 'schedule') showScreen('schedule'); else showScreen('home');
    

    init();
  </script>
</body>
</html>

